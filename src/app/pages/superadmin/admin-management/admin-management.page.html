<ion-header [translucent]="true">
  <ion-toolbar style="--background: linear-gradient(45deg, #21233d, #71a2ce)">
    <ion-buttons slot="start">
      <ion-menu-button auto-hide="false">
        <ion-icon name="menu-outline" style="color: white; font-size: 24px;"></ion-icon>
      </ion-menu-button>
    </ion-buttons>
    <ion-title style="color: white;">Admin Management</ion-title>
    <ion-buttons slot="end" style="color: white;">
      <ion-select [(ngModel)]="selectedOrgId" (ionChange)="onOrganizationChange($event)" interface="popover">
        <ion-select-option *ngFor="let org of organizations" [value]="org.orgId">
          {{ org.orgName }}
        </ion-select-option>
      </ion-select>
    </ion-buttons>
  </ion-toolbar>
</ion-header>

<ion-content [fullscreen]="true">
  <ion-item-divider class="searchBarFixed">
    <ion-searchbar class="search-bar" show-clear-button="always" [(ngModel)]="searchQuery"
      placeholder="Search by Email or Status" (ionClear)="clearSearch()" (keyup.enter)="adminManagement($event)">
    </ion-searchbar>
  </ion-item-divider>
  <app-loader *ngIf="isLoading"></app-loader>
  <div *ngIf="noRecord">
    <ion-row>
      <img class="noRecord" src="../../../../assets/images/Animation - 1737116880117.gif" />
    </ion-row>
  </div>
  <ion-grid class="custom-card" *ngIf="!isLoading && !noRecord">
    <ion-row>
      <ion-col *ngFor="let data of adminResults" size="12">
        <ion-card class="admin-card">
          <ion-card-header>
            <ion-card-title>{{ data.name }}</ion-card-title>
            <ion-card-subtitle>Username: {{ data.userName }}</ion-card-subtitle>
          </ion-card-header>
          <ion-card-content>
            <p class="status-pill" [ngStyle]="{
              'background-color': getStatusColor(data.Status).backgroundColor,
              'color': getStatusColor(data.Status).textColor
            }">
              {{ data.Status }}
            </p>
          </ion-card-content>
        </ion-card>
      </ion-col>
    </ion-row>
  </ion-grid>
  <ion-modal [isOpen]="isItemModalOpen" (willDismiss)="isItemModalOpen = false"
    style="--width: 80%; --height: 63%; --max-width: 90%; --max-height: 90%; --border-radius: 15px; --box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2); --padding: 15px;">
   
    <ng-template>
      <form [formGroup]="userForm" (ngSubmit)="onSubmit()">
      <ion-item fill="outline" style="display: flex; flex-direction: row;">
          <h2 style="color: #21233d;">Add Admin</h2>
          <ion-icon name="close-circle" style="color: #21233d; font-size: x-large; cursor: pointer;margin-left: 158px;margin-top: 10px"
            (click)="isItemModalOpen = false">
          </ion-icon>
        </ion-item> 
            <ion-item fill="outline">
              <ion-label position="floating">Username</ion-label>
              <ion-input formControlName="username" type="text" placeholder="Enter Username"></ion-input>
            </ion-item>
            <ion-item fill="outline">
              <ion-label position="floating">First Name</ion-label>
              <ion-input formControlName="firstName" type="text" placeholder="Enter First Name"></ion-input>
            </ion-item>
            <ion-item fill="outline">
              <ion-label position="floating">Last Name</ion-label>
              <ion-input formControlName="lastName" type="text" placeholder="Enter Last Name"></ion-input>
            </ion-item>
            <ion-item fill="outline">
              <ion-label position="floating">Password</ion-label>
              <ion-input formControlName="password" type="password" placeholder="Enter Password"></ion-input>
            </ion-item>
          
            <ion-item fill="outline" *ngIf="!showNewOrgInput">
              <ion-label position="floating">Organization</ion-label>
              <ion-select formControlName="organization" interface="popover" multiple="true"
                [value]="selectedOrgIds" (ionChange)="onOrganizationChanging($event)"
                labelPlacement="floating">
                <ion-select-option *ngFor="let org of organizations" [value]="org.id">
                  {{ org.orgName }}
                </ion-select-option>
                <ion-select-option value="addNew">+ Add Organization</ion-select-option>
              </ion-select>
            </ion-item>
            
            <ion-item *ngIf="showNewOrgInput">
              <ion-input formControlName="newOrganization" placeholder="Enter new organization name"></ion-input>
              <ion-button fill="clear" (click)="addNewOrganization()" style="--background: linear-gradient(45deg, #21233d, #71a2ce)">Add</ion-button>
              <ion-button fill="clear" (click)="cancelNewOrganization()" style="--background: linear-gradient(45deg, #21233d, #71a2ce)">
                <ion-icon name="close-circle"  style="color: white; "></ion-icon>
              </ion-button>
            </ion-item>            
            <div style="display: flex; justify-content: center; margin-top: 10px;">
              <ion-button type="submit" style="--background: linear-gradient(45deg, #21233d, #71a2ce)">
                Submit
              </ion-button>
            </div>            
        </form>

    </ng-template>
  </ion-modal>
  <ion-fab slot="fixed" vertical="bottom" horizontal="end">
    <ion-fab-button style="--background: linear-gradient(45deg, #21233d, #71a2ce)" (click)="addAdmin()">
      <ion-icon name="add" style="color: white;"></ion-icon>
    </ion-fab-button>
  </ion-fab>
  <ion-fab slot="fixed" vertical="bottom" horizontal="end">
    <ion-fab-button style="--background: linear-gradient(45deg, #21233d, #71a2ce)" (click)="addAdmin()">
      <ion-icon name="add" style="color: white;"></ion-icon>
    </ion-fab-button>
  </ion-fab>
</ion-content>
<app-loader *ngIf="isLoading"></app-loader>