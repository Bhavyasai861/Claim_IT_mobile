<ion-header>
  <ion-toolbar style="--background: #00897b;">
    <ion-buttons slot="start">
      <ion-menu-button auto-hide="false">
        <ion-icon name="menu-outline" style="color: white; font-size: 24px;"></ion-icon>
      </ion-menu-button>
    </ion-buttons>
    <ion-title style="color: white;">Search and Claim</ion-title>
  </ion-toolbar>
</ion-header>
<ion-content>
  <!-- <ion-item-divider class="searchBarFixed">
    <ion-grid>
      <ion-row>
          <div class="search-container">
            <ion-searchbar class="search-bar" [(ngModel)]="searchQuery" placeholder="Search with item"
              showCancelButton="focus" (ionClear)="clearAll()" (keyup.enter)="searchItems()"></ion-searchbar>
            <ion-icon name="filter" style="margin-top: 15px; cursor: pointer; font-size: 25px;"
              (click)="openPopover($event)"></ion-icon>
            <input type="file" accept="image/*" (change)="onFileSelect($event)" hidden #fileInput />
            <ion-icon name="camera" style="margin-top: 15px; cursor: pointer; font-size: 25px;"
              (click)="fileInput.click()"></ion-icon>
            <ion-icon *ngIf="searchQuery || selectedCategory || files.length" name="close-circle" size="small"
              style="position: absolute; top: 0; right: 0;" (click)="clearAll()"></ion-icon>
          </div>       
      </ion-row>
    </ion-grid>
  </ion-item-divider> -->
  <ion-item-divider class="searchBarFixed">
    <ion-grid>
      <ion-row>
        <ion-col size="9">
          <ion-searchbar class="search-bar" [(ngModel)]="searchQuery" placeholder="Search with item"
            showCancelButton="focus" (ionClear)="clearSearch()" (keyup.enter)="searchItems()"></ion-searchbar>
        </ion-col>
        <ion-col size="1">
          <ion-icon name="filter" style="margin-top: 15px; cursor: pointer; font-size: 25px;"
            (click)="openPopover($event)"></ion-icon>
          <ion-popover [isOpen]="popoverOpen" (didDismiss)="popoverOpen = false" [event]="popoverEvent">
            <ng-template>
              <div *ngFor="let category of categories" class="custom-dropdown" (click)="selectCategory(category.name)">
                {{ category.name }}
              </div>
            </ng-template>
          </ion-popover>
        </ion-col>
        <ion-col size="1">
          <input type="file" accept="image/*" (change)="onFileSelect($event)" hidden #fileInput />
          <ion-icon name="camera" style="margin-top: 15px; cursor: pointer; font-size: 25px;"
            (click)="fileInput.click()"></ion-icon>
          <!-- <ion-icon name="close-circle" size="small" style="position: absolute; top: 0; right: 0; "
            (click)="clearSearch()">
          </ion-icon> -->
        </ion-col>
        <ion-col size="1">
          <!-- <p *ngIf="searchQuery || selectedCategory || files.length" (click)="clearAll()">clear</p> -->
          <ion-icon *ngIf="searchQuery || selectedCategory || files.length" name="close-circle"
             (click)="clearAll()"  style="margin-top: 15px; cursor: pointer; font-size: 25px;"></ion-icon>
        </ion-col>
      </ion-row>
    </ion-grid>

  </ion-item-divider>
  <div *ngIf="isLoading" class="loading-container">
    <ion-spinner name="crescent"></ion-spinner>
  </div>
  <ion-grid class="custom-card">
    <ion-row *ngFor="let item of items"
    style="align-items: center; border-bottom: 1px solid #dcdcdc; margin-top: 2px; padding: 10px;" class="card-row">
    <ion-col size="4">
      <img [src]="getImage(item.image)" alt="Item Image"
        style="width: 60%; max-height: 100px; margin: auto; display: block;" (click)="openImageModal(item.image)" />
    </ion-col>
    <ion-col size="6" style="font-size: 14px; color: #666;">
      <p style="font-size: 14px; font-weight: bold; color: #333;">{{ item.name }}</p>
      <p style="font-size: 12px; color: #999;">Received Date: {{ item.receivedDate | date: 'shortDate' }}</p>
      <p style="font-size: 12px; padding: 5px; border-radius: 5px;width: fit-content;" [ngStyle]="{
        'background-color': getStatusColor(item.status),
        'color': getTextColor(item.status)
      }">
        {{ item.status }}
      </p>
    </ion-col>
    <ion-col size="2" style="text-align: center;">
      <ion-icon name="qr-code-outline" class="qrIcon"></ion-icon>
      <ion-button expand="block" size="small" (click)="onButtonClick(item)">
        Claim
      </ion-button>
    </ion-col>
  </ion-row>
  
  </ion-grid>
  <ion-modal [isOpen]="isImageModalOpen" (didDismiss)="closeImageModal()"
    style="--width: 300px; --height: 270px; --max-width: 90%; --max-height: 90%; --border-radius: 15px; --box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);">
    <ng-template>
      <ion-content>
        <div style="text-align: center;">
          <img [src]="selectedImage" alt="Selected Image" style="width: 90%; height: 250px; object-fit: contain;" />
          <ion-button fill="clear" (click)="closeImageModal()" style="position: absolute; top: 10px; right: 10px;">
            <ion-icon name="close" style="color: #f90000;"></ion-icon>
          </ion-button>
        </div>
      </ion-content>
    </ng-template>
  </ion-modal>

</ion-content>